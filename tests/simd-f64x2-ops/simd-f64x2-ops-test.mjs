// Generated by 🤖
import { readTestData, logger } from '../test-utils.mjs';

async function testSIMDf64x2Ops(debug = false) {
  const log = logger(debug);
  try {
    const { wasmBuffer } = await readTestData('simd-f64x2-ops/simd-f64x2-ops.wat', debug);
    log('SIMD f64x2 operations test WAT file loaded successfully');
    
    const { instance } = await WebAssembly.instantiate(wasmBuffer);
    log('SIMD f64x2 operations test WASM module instantiated successfully');
    
    const tests = [
      // Rounding operations
      { name: "f64x2.ceil", fn: "f64x2_ceil_test", expected: 3.0, allowError: 0.0001 },
      { name: "f64x2.floor", fn: "f64x2_floor_test", expected: 2.0, allowError: 0.0001 },
      { name: "f64x2.trunc", fn: "f64x2_trunc_test", expected: 2.0, allowError: 0.0001 },
      { name: "f64x2.nearest", fn: "f64x2_nearest_test", expected: 2.0, allowError: 0.0001 },
      
      // Unary operations
      { name: "f64x2.abs", fn: "f64x2_abs_test", expected: 1.0, allowError: 0.0001 },
      { name: "f64x2.neg", fn: "f64x2_neg_test", expected: -1.0, allowError: 0.0001 },
      { name: "f64x2.sqrt", fn: "f64x2_sqrt_test", expected: 1.0, allowError: 0.0001 },
      
      // Binary operations
      { name: "f64x2.add", fn: "f64x2_add_test", expected: 4.0, allowError: 0.0001 },
      { name: "f64x2.sub", fn: "f64x2_sub_test", expected: 2.0, allowError: 0.0001 },
      { name: "f64x2.mul", fn: "f64x2_mul_test", expected: 3.0, allowError: 0.0001 },
      { name: "f64x2.div", fn: "f64x2_div_test", expected: 3.0, allowError: 0.0001 },
      
      // Min/max operations
      { name: "f64x2.min", fn: "f64x2_min_test", expected: -1.0, allowError: 0.0001 },
      { name: "f64x2.max", fn: "f64x2_max_test", expected: 1.0, allowError: 0.0001 },
      { name: "f64x2.pmin", fn: "f64x2_pmin_test", expected: -1.0, allowError: 0.0001 },
      { name: "f64x2.pmax", fn: "f64x2_pmax_test", expected: 1.0, allowError: 0.0001 }
    ];
    
    let passed = 0;
    let failed = 0;
    
    for (const test of tests) {
      const result = instance.exports[test.fn]();
      const isClose = Math.abs(result - test.expected) <= test.allowError;
      
      log(`${test.name} test: expected ${test.expected}, got ${result}`);
      
      if (isClose) {
        log(`✅ ${test.name} test passed!`);
        passed++;
      } else {
        log(`❌ ${test.name} test failed! Expected: ${test.expected}, Got: ${result}`);
        failed++;
        throw new Error(`${test.name} test failed! Expected: ${test.expected}, Got: ${result}`);
      }
    }
    
    log(`Tests completed: ${passed} passed, ${failed} failed`);
    return failed === 0;
  } catch (error) {
    log(`Error in SIMD f64x2 operations test: ${error.message}`, "ERROR");
    return false;
  }
}

export default testSIMDf64x2Ops;
